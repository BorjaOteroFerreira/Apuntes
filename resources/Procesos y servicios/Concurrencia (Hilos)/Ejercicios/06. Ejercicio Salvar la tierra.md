<br>
<small>Tanto el contenido como la estructura de estos apuntes ha sido realizado integramente por <b>David Lopez Amenedo</b></small><br>
<small>Esta obra est√° bajo una <a href="https://creativecommons.org/licenses/by-sa/4.0/">licencia de Creative Commons Reconocimiento-CompartirIgual 4.0 Internacional</a>.</small>


## Salvar la Tierra

**Enunciado**


* El planeta Tierra est√° en peligro debido a varios meteoritos que se acercan directamente para impactar contra ella.
* La empresa HWWC va a mandar todas las naves disponibles para intentar solucionar el problema.
* Las naves tipo A (Armageddon) van a dedicarse a aterrizar en un meteorito, taladrar durante un tiempo aleatorio y esperar a que llegue una nave tipo B para que les surta de combustible.
* Las naves tipo BS (Bomberos-Surtidores) se dedican a ir a un meteorito y, si ya ha sido taladrado, surtir de combustible la nave que all√≠ se encuentra y poner una bomba para explosionarlo.
* Las naves se comunicar√°n con la HWWC para obtener la localizaci√≥n (referencia) de un meteorito (al azar) de entre los que quedan.


**Constantes**

* `NUM_METEORITOS = 10`
* `NUM_NAVES_A = 5`
* `NUM_NAVES_BS = 3`


### Meteorito.java  

```java
// Clase principal que representa el meteorito

class Meteorito {
    private int id;
    private boolean taladrado = false;
    private boolean destruido = false;
    private Nave naveActual = null;

    public Meteorito(int id) {
        this.id = id;
    }

public synchronized void aterrizar(Nave nave) throws InterruptedException {
    while (naveActual != null) {
        if(naveActual instanceof Bombardero){
            wait();
        }
        return;
    }
    naveActual = nave;
    System.out.printf("[%tT] üõ∏ Perforadora-%d ha aterrizado en meteorito %d%n", 
        new Date(), nave.getId(), id);
}

public synchronized void taladrar() {
    taladrado = true;
    System.out.printf("[%tT] üî® Perforadora-%d ha completado el taladrado del meteorito %d%n", 
        new Date(), naveActual.getId(), id);
}

public synchronized void surtirCombustible() {
    System.out.printf("[%tT] ‚õΩ Bombardero-%d est√° surtiendo combustible en meteorito %d%n", 
        new Date(), naveActual.getId(), id);
     notifyAll();
}

public synchronized void destruir() {
        System.out.println("Meteorito " + id + " ha sido destruido");
        destruido = true;
        naveActual = null;
        notifyAll();
    }

    public synchronized boolean estaDestruido() {
        return destruido;
    }

    public boolean estaTaladrado() {
        return taladrado;
       
    }
}
```
### Hwwc.java (Estacion)

```java
// Clase que representa la empresa HWWC
public class Hwwc {

    private List<Meteorito> meteoritos;

    public Hwwc(int numMetoritos) {
        meteoritos = new ArrayList<>();
        for (int i = 0; i < numMetoritos; i++) {
            meteoritos.add(new Meteorito(i));
        }
    }

    public synchronized Meteorito obtenerMeteoritoDisponible() {
        List<Meteorito> disponibles = meteoritos.stream()
            .filter(m -> !m.estaDestruido())
            .collect(Collectors.toList());
        
        if (disponibles.isEmpty()) {
            return null;
        }

        Random rand = new Random();
        return disponibles.get(rand.nextInt(disponibles.size()));
    }

    public boolean todosDestruidos() {
        return meteoritos.stream().allMatch(Meteorito::estaDestruido);
    }
}

```

### Nave.java

```java
// Clase abstracta base para las naves
abstract class Nave extends Thread {
    protected int id;
    protected HWWC hwwc;

    public Nave(int id, HWWC hwwc) {
        this.id = id;
        this.hwwc = hwwc;
    }

    public int getId() {
        return id;
    }
}
```

### Perforadora.java (Extiende de nave)

```java
// Clase para las naves tipo A (Armageddon)
public class Perforadora extends Nave{
    public Perforadora(int id, Hwwc hwwc) {
         super(id, hwwc);
    }
    
    @Override
    public void run() {
        while (!hwwc.todosDestruidos()) {
            try {
                Meteorito meteorito = hwwc.obtenerMeteoritoDisponible();
                if(meteorito != null && !meteorito.estaDestruido() && !meteorito.estaTaladrado()){
                    // Aterrizar en el meteorito
                    meteorito.aterrizar(this);
                    // Taladrar el meteorito
                    meteorito.taladrar();
                    // Esperar a que llegue una nave BS
                    synchronized (meteorito) {
                        meteorito.wait();
                    }
                }
            } catch (InterruptedException e) {
                Thread.currentThread().interrupt();
                break;
            }
        }
    }
}

```

### Bombardero.java (Extiende de Nave)

```java
// Clase para las naves tipo BS (Bomberos-Surtidores)
public class Bombardero extends Nave{
    
    public Bombardero(int id, Hwwc hwwc){
        super(id, hwwc);
    }

    @Override
    public void run() {
        while (!hwwc.todosDestruidos()) {
            Meteorito meteorito = hwwc.obtenerMeteoritoDisponible();
            if (meteorito == null) break;

            // Verificar si el meteorito est√° taladrado
            if (meteorito.estaTaladrado() && !meteorito.estaDestruido()) {
      
                // Surtir combustible
                meteorito.surtirCombustible();
                synchronized (meteorito) {
                    meteorito.notify();
                }
    
                // Colocar y detonar bomba
                meteorito.destruir();
            }
        }
    }
}
```


### SalvarLaTierra.java (Main)


```java
// Clase principal para ejecutar la simulaci√≥n
public class SalvarLaTierra {
    private static final int NUM_METEORITOS = 10;
    private static final int NUM_NAVES_A = 5;
    private static final int NUM_NAVES_BS = 3;

    public static void main(String[] args) {
        System.out.println("=== INICIO DE LA MISI√ìN DE SALVAMENTO ===");
        System.out.printf("Meteoritos detectados: %d%n", NUM_METEORITOS);
        System.out.printf("Naves tipo Perforadora disponibles: %d%n", NUM_NAVES_A);
        System.out.printf("Naves tipo Bombardero disponibles: %d%n", NUM_NAVES_BS);
        System.out.println("=======================================");
        Hwwc hwwc = new Hwwc(NUM_METEORITOS);
        List<Nave> naves = new ArrayList<>();

        // Crear e iniciar naves tipo A
        for (int i = 0; i < NUM_NAVES_A; i++) {
            Nave naveA = new Perforadora(i, hwwc);
            naves.add(naveA);
            naveA.start();
        }

        // Crear e iniciar naves tipo BS
        for (int i = 0; i < NUM_NAVES_BS; i++) {
            Nave naveBS = new Bombardero(i + NUM_NAVES_BS, hwwc);
            naves.add(naveBS);
            naveBS.start();
        }

        // Esperar a que todas las naves terminen
        for (Nave nave : naves) {
            try {
                nave.join();
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        }
        System.out.println("=======================================");
        System.out.println("üåç ¬°Misi√≥n completada! La Tierra est√° a salvo.");
        System.out.println("=======================================");
    }
}
```

**Salida por consola**

```python
=== INICIO DE LA MISI√ìN DE SALVAMENTO ===
Meteoritos detectados: 10
Naves tipo A disponibles: 5
Naves tipo BS disponibles: 3
=======================================
```

```bash 
[10:15:23] üõ∏ Nave A-0 ha aterrizado en meteorito 3
[10:15:23] üõ∏ Nave A-1 ha aterrizado en meteorito 7
[10:15:23] üõ∏ Nave A-2 ha aterrizado en meteorito 1
[10:15:24] üî® Nave A-1 ha completado el taladrado del meteorito 7
[10:15:24] üõ∏ Nave A-3 ha aterrizado en meteorito 4
[10:15:25] üî® Nave A-0 ha completado el taladrado del meteorito 3
[10:15:25] ‚õΩ Nave BS-5 est√° surtiendo combustible en meteorito 7
[10:15:26] üí• Nave BS-5 ha destruido el meteorito 7
[10:15:26] üî® Nave A-2 ha completado el taladrado del meteorito 1
[10:15:27] ‚õΩ Nave BS-6 est√° surtiendo combustible en meteorito 3
[10:15:27] üî® Nave A-3 ha completado el taladrado del meteorito 4
[10:15:28] üí• Nave BS-6 ha destruido el meteorito 3
[10:15:28] üõ∏ Nave A-4 ha aterrizado en meteorito 9
[10:15:29] ‚õΩ Nave BS-7 est√° surtiendo combustible en meteorito 1
[10:15:30] üí• Nave BS-7 ha destruido el meteorito 1
[10:15:30] üî® Nave A-4 ha completado el taladrado del meteorito 9
[10:15:31] ‚õΩ Nave BS-5 est√° surtiendo combustible en meteorito 4
[10:15:32] üí• Nave BS-5 ha destruido el meteorito 4
...
[10:15:45] üí• Nave BS-7 ha destruido el meteorito 9
=======================================
üåç ¬°Misi√≥n completada! La Tierra est√° a salvo.
=======================================
```